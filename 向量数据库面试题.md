## 向量数据库原理是什么？ 请简述下它的原理

向量数据库的核心原理是通过将高维数据（如图像、文本）转换为多维向量，并基于相似性度量（如余弦相似度、欧氏距离），利用高效的索引结构和近似最近邻（ANN）算法，快速检索与目标最相似的向量结果。


**1. 向量化引擎**

- 通过嵌入模型（Embedding Model）将非结构化数据（文本/图像/视频）映射为稠密向量
- 典型模型：BERT（文本）、ResNet（图像）、CLIP（多模态）
- 输出维度：通常128-2048维（如OpenAI text-embedding-3-large输出3072维）

**2. 索引结构**

- 分层导航小世界图（HNSW）：建立多层图结构实现对数级搜索复杂度（O(log N)）
- 乘积量化（PQ）：将高维向量分解为低维子空间进行压缩，降低内存占用
- 倒排索引（IVF）：通过聚类建立倒排列表，仅搜索相关分区

**3. 相似度计算**

- 距离度量：欧式距离（L2）、内积（IP）、余弦相似度（归一化后等价于IP）
- 近似最近邻（ANN）算法：在精度与速度间权衡，召回率可达95%+时延迟<10ms

**4. 分布式架构**

- 水平扩展：通过一致性哈希实现数据分片（如Milvus的DataNode集群）
- 流批一体：支持实时写入与批量导入（QPS>10万级）
- 混合存储：热数据存内存/Pmem，冷数据落盘（如磁盘SSD+Optane分层）



## Milvus 常见索引类型

- FLAT：暴力搜索，精度最高，速度慢，适合小数据量或高精度需求。
- IVF_FLAT：倒排文件索引，适合大数据量，速度快，精度略有损失。
- HNSW：基于图的近似最近邻索引，速度快，精度高，适合大规模检索。
- AUTOINDEX：让 Milvus 自动选择最合适的索引类型（推荐新手用）。

## score是越高越好吗？

不是

1. L2 距离（欧氏距离，metric_type="L2"）
score 实际上是“距离”，越小越相似，越小越好。
例如：score=0.1 比 score=0.5 更相似。
2. 内积（IP，metric_type="IP" 或 "COSINE"）
score 是“相似度”，越大越相似，越大越好。
例如：score=0.9 比 score=0.5 更相似。

## 向量数据库中的索引 HNSW、LSH、PQ 分别是什么意思？

HNSW（Hierarchical Navigable Small World）图（图结构）

- 在高维空间中，将所有向量组织成分层“小世界”图。
- 查询时，从上层稀疏图贪心跳转到最相似邻居，逐层下探到密集的底层图，快速找到近似最邻近点。

LSH（Locality‑Sensitive Hashing）哈希（哈希分桶）

- 利用一组专门设计的哈希函数，把相似向量映射到同一个或相邻的哈希桶。
- 查询时只需查对应桶内的候选项，再做精确排序，极大缩小检索范围。

PQ（Product Quantization）量化（向量化）

- 将高维向量切分成若干子块，对每块分别做聚类，用“码字”来近似原始子向量。
- 存储时只保存每段的码字索引，检索时通过查预先计算好的子块距离表来快速估算向量间距离。

| 技术  | 核心目的         | 适用场景             | 优势                 | 代价         |
|-------|------------------|----------------------|----------------------|--------------|
| HNSW  | 高精度快速搜索   | 十亿级数据实时检索   | 精度高、速度快       | 内存占用高   |
| LSH   | 极速粗筛         | 去重、过滤重复内容   | 速度极快（O(1)）     | 精度损失     |
| PQ    | 压缩存储+加速计算 | 移动端、内存受限场景 | 内存/计算量大幅降低  | 轻微精度损失 |

- 他们都属于ANN算法


## 向量数据库中，常见的向量搜索方法：余弦相似度、欧几里得距离和曼哈顿距离分别是什么？有什么区别？

| 维度       | 余弦相似度     | 欧几里得距离     | 曼哈顿距离         |
|------------|----------------|------------------|--------------------|
| 关注点     | 方向一致性     | 绝对位置差异     | 各维度差异总和     |
| 计算复杂度 | 低（适合高维） | 中等             | 低（适合并行计算） |
| 抗噪能力   | 高（忽略长度） | 低（对异常值敏感）| 中等（线性惩罚差异）|
| 典型场景   | 文本语义匹配   | 图像/空间数据搜索 | 统计特征匹配      |